# **3200105788 孙川 智能家居管理系统**

# A 设计文档

## 一、需求分析

### 1.1	业务需求

任选Web开发技术实现一个用于智能家居设备管理的系统，支持智能家居的创建监控和调节

### 1.2	功能需求

需要实现的基本功能如下：

1.   用户注册、登录功能
     1.   用户名：6字符以上，且唯一
     2.   密码：6字符以上，必须含有数字、字母(区分大小写)
     3.   邮箱：邮箱格式，且唯一
2.   创建场所
     1.   登录之后，跳转至创建场所界面
     2.   每个用户可以有不同的场所，且会保留历史记录
     2.   提供画图功能，画出场所图
3.   创建房间
     1.   只有进入某个场所后，才能在该场所内创建房间
     2.   每个房间仅对应一个场所
     3.   一个场所可以有多个房间
4.   创建智能设备
     1.   只有进入某个房间后，才能在该房间内创建智能设备
     2.   每个房间可以有多个智能设备
     3.   智能设备根据模板创建，在添加用户的自定义设置
5.   智能设备的种类
     1.   灯：支持开关、亮度调节
     2.   其它智能设备的开关
     3.   传感器：温湿度查看、其它信息的查看
     4.   门锁：开关门状态
6.   列表信息查看设备状态
7.   可视化界面查看设备状态
     1.   在房间内上摆放设备
     3.   提供一些模板
8.   可以在手机上查看，手机应用可以是网页，也可以是`app`

后端程序基于`express`的`nodejs`程序，前端基于`vue3`、`three.js`等库进行开发。数据库使用远程mysql数据库。

## 二、使用的数据库及框架

1. 使用的数据库：MySQL

   1. 服务器的代码框架，在server.js中
   2. 其相关交互的具体实现细节，在apps目录下。
   3. 这里我们使用`knex`作为与MySQL间的接口：

   ```javascript
   const db = knex({
       client: 'mysql',
       connection: {
           host: 'sc.scitbb.top',
           user: 'sunc',
           password: '',// 略去
           database: 'BS'
       }
   })
   ```

2. 框架：`Express`（后端框架）、`three.js`（前端渲染管线）等
3.  由于找不到合适的3D模型，这里面的不同的智能家居设备，我都使用不同纹理的立方体进行表示。

## 三、核心数据模型

在数据库中，我们需要存储的表的结构如下图所示



![image-20221107000635414](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20221107000635414.png)

数据模型分为三部分：用户、场所以及设备。

用户管理将用户的邮箱/电话号码设置为主键，用户名和密码作为普通键值。

场所模型：每个场所对应一个名称，每个用户对应多个场所。

设备模型：每个设备都有自身的id，以及种类的编号。每个场所可以对应多个设备。这些设备是互相继承的关系

![image-20221107194051822](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20221107194051822.png)

## 四、主要功能实现的界面原型

### 3.1	登录/注册界面

如果没有登陆，那么登陆注册界面是此系统的默认主界面。正中心显示登陆和注册选项，简约明了。

在开发后期，我会对界面的风格针对不同种类的ui进行调整，使其也同样适用于手机端/app浏览。

![image-20221106233737212](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20221106233737212.png)

登陆后显示的欢迎页面，因为用户名是Test，所以显示的是“Hello Test”。右上角是退出登录选项。点击正中的欢迎信息可以进入场所的管理界面。

![image-20230112165423096](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112165423096.png)

### 3.1	注册界面

![image-20230112165129517](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112165129517.png)

如果是第一次使用，可以进入注册界面，输入用户名、email和密码进行注册。如果注册成功，将退回到登陆界面。

服务器会对输入的用户名email和密码进行检查，如果合法则注册成功并返回正确信息。

如果已经有用户，可以点击下方按钮进行登陆操作。

### 3.2	房间创建/选择界面

在场所管理界面中，用户可以对用户名下的房屋进行创建和选择。

房屋有三种预设户型，其图片和说明会在随后的开发中进行增添。

用户可以在右半部分的搜索部分查看并查找自己想要进行管理的特定房屋。

![image-20230112165438717](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112165438717.png)

在左侧部分可以进行创建，创建后会在右边的house目录中显示出来。这里我们添加一个叫做邪王真眼的房屋。

![image-20230112165627779](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112165627779.png)

右侧选择邪王真眼，点击选择按钮，即可进入对应房屋。此时房屋是空的。

![image-20230112165955549](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112165955549.png)



### 3.3	房间界面

下图是房间界面。用户可以在给定的户型模板上进行对户型的自定义修改。

前端渲染模式基于WebGL的three.js。整个房间的自定义设置类似于沙盒模式，用户可以在想要的位置增加自己的智能终端，并设置/监控其设备参数。

![image-20221106235435408](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20221106235435408.png)

房间界面的操作有两种模式，编辑模式和浏览模式。编辑模式中，可以对所选户型进行自定义设计，在浏览模式中，可以对所选实体（如智能家具等进行更改）。

#### 3.3.1 编辑模式

![image-20230112203058049](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112203058049.png)

在编辑模式中，我们可以通过键盘进行视角更改，通过鼠标进行智能家居的增删。我们还可以用不同颜色的其他种类方块作为我们户型图的墙壁，进行自定义创造编辑。

下面是我们将房屋换一个角度进行查看。可见，房屋中的模型具有很好的3D视觉效果，方便进行相应的空间管理。

![image-20230112212543231](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112212543231.png)

#### 3.3.2 浏览模式

![image-20230112211209632](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20230112211209632.png)

在浏览模式下，我们同样可以通过键盘进行视角更改，但是鼠标的操作变成了对场景中物体的选择。根据选择的物体，系统会在右侧显示他的各种参数，通过编辑右侧菜单的参数，我们可以对智能设备的参数进行更新和调整。

## 五、流程说明

![image-20221107200301923](https://cdn.jsdelivr.net/gh/SankHyan24/image1/img/image-20221107200301923.png)

# B 使用手册：

> 在本章节，我将演示如何启动并使用本系统